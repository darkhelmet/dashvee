(function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t={}.hasOwnProperty;this.Embedly=function(){function n(t,n,r){var i,s,o,u,a,f,l;this.options=t,this.elements=n,this.callback=r,this.processEmbeds=e(this.processEmbeds,this),this.embed=e(this.embed,this),(l=this.callback)==null&&(this.callback=this.embed),this.dict={},u=[];for(a=0,f=n.length;a<f;a++)i=n[a],u.push(i.href),this.dict[i.href]=i;o=""+this.options.scheme+"//api.embed.ly/1/oembed",s=$.ajax({url:o,dataType:"jsonp",data:this.buildParams(u)}),s.done(this.processEmbeds)}return n.templates={photo:Handlebars.compile("<a href='{{url}}' target='_blank'><img style='{{imageStyle}}' src='{{oembed.url}}' alt='{{title}}' /></a>"),wrap:Handlebars.compile("<{{element}} class='{{class}}'>{{{code}}}</{{element}}>"),thumb:Handlebars.compile("<img src='{{src}}' class='thumb' style='{{style}}'/>"),description:Handlebars.compile("<div class='description'>{{description}}</div>"),provider:Handlebars.compile("<a href='{{url}}' class='provider'>{{name}}</a>"),link:Handlebars.compile("<a href='{{url}}'>{{title}}</a>")},n.defaults={scheme:"http:",frame:!1,wmode:"opaque",method:"replace",addImageStyles:!0,wrapElement:"div",className:"embed"},n.prototype.buildParams=function(e){var n,r,i,s,o,u,a,f;return r={key:this.options.key,urls:e.map(escape).join(",")},(s=r.maxWidth)==null&&(r.maxWidth=this.options.maxWidth),(o=r.maxHeight)==null&&(r.maxHeight=this.options.maxHeight),(u=r.chars)==null&&(r.chars=this.options.chars),(a=r.words)==null&&(r.words=this.options.words),(f=r.frame)==null&&(r.frame=this.options.frame),r.wmode=this.options.wmode,function(){var e;e=[];for(n in r){if(!t.call(r,n))continue;i=r[n],i!=null&&e.push(""+n+"="+i)}return e}().join("&")},n.prototype.embed=function(e,t){switch(this.options.method){case"replace":return $(t).replaceWith(e.code);case"after":return $(t).after(e.code);case"afterParent":return $(t).parent().after(e.code);case"replaceParent":return $(t).parent().replaceWith(e.code)}},n.prototype.createImageStyle=function(){var e;return e=[],this.options.addImageStyles&&(this.options.maxWidth!=null&&e.push("max-width: "+this.options.maxWidth+"px"),this.options.maxHeight!=null&&e.push("max-height: "+this.options.maxHeight+"px")),e.join(";")},n.prototype.processEmbeds=function(e){var t,n,r,i,s;s=[];for(t=r=0,i=e.length;r<i;t=++r)n=e[t],s.push(this.processEmbed(n,this.elements[t]));return s},n.prototype.processEmbed=function(e,t){var r,i,s,o,u,a;return r=function(){switch(e.type){case"photo":return a=e.title||"",n.templates.photo({url:t.href,imageStyle:this.createImageStyle(),title:a,oembed:e});case"video":case"rich":return e.html;default:return a=e.title||t.href,u=e.thumbnail_url!=null?n.templates.thumb({src:e.thumbnail_url,style:this.createImageStyle()}):"",i=e.description!=null?n.templates.description({description:e.description}):"",o=e.provider_name!=null?n.templates.provider({url:e.provider_url,name:e.provider_name}):void 0,s=n.templates.link({url:t.href,title:a}),[u,s,o,i].join()}}.call(this),this.options.wrapElement==="div"&&$.browser.msie&&$.browser.version<9&&(this.options.wrapElement="span"),this.options.wrapElement&&(r=n.templates.wrap({element:this.options.wrapElement,"class":this.options.className,code:r})),e.code=r,$(t).data("oembed",e).trigger("embedly:oembed",e),this.callback(e,t)},n}(),function(e){return e.fn.embedly=function(t,n){var r;r=e(this).filter(function(){return t.re.test(this.href)});if(r.length===0)return;return t=e.extend({},Embedly.defaults,t),new Embedly(t,r,n)}}(jQuery)}).call(this);