// Copyright (c) 2009 The Chromium Authors. All rights reserved.
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.
/**
 * @fileoverview CFInstall.js provides a set of utilities for managing
 * the Chrome Frame detection and installation process.
 * @author slightlyoff@google.com (Alex Russell)
 */
(function(e){if(e.CFInstall)return;var t=function(e,t){return typeof e=="string"?(t||document).getElementById(e):e},n=function(){if(e.CFInstall._force)return e.CFInstall._forceValue;var t=navigator.userAgent.toLowerCase();if(t.indexOf("chromeframe")>=0)return!0;if(typeof window["ActiveXObject"]!="undefined")try{var n=new ActiveXObject("ChromeTab.ChromeFrame");if(n)return!0}catch(r){}return!1},r=function(e){try{var t=document.createElement("style");t.setAttribute("type","text/css"),t.styleSheet?t.styleSheet.cssText=e:t.appendChild(document.createTextNode(e));var n=document.getElementsByTagName("head")[0],r=n.firstChild;n.insertBefore(t,r)}catch(i){}},i=!1,s=!1,o=function(){if(i)return;var e='.chromeFrameInstallDefaultStyle {width: 800px;height: 600px;position: absolute;left: 50%;top: 50%;margin-left: -400px;margin-top: -300px;}.chromeFrameOverlayContent {position: absolute;margin-left: -400px;margin-top: -300px;left: 50%;top: 50%;border: 1px solid #93B4D9;background-color: white;z-index: 2001;}.chromeFrameOverlayContent iframe {width: 800px;height: 600px;border: none;}.chromeFrameOverlayCloseBar {height: 1em;text-align: right;background-color: #CADEF4;}.chromeFrameOverlayUnderlay {position: absolute;width: 100%;height: 100%;background-color: white;opacity: 0.5;-moz-opacity: 0.5;-webkit-opacity: 0.5;-ms-filter: "progid:DXImageTransform.Microsoft.Alpha(Opacity=50)";filter: alpha(opacity=50);z-index: 2000;}';r(e),i=!0},u=function(){if(s)return;var e=".chromeFrameOverlayContent { display: none; }.chromeFrameOverlayUnderlay { display: none; }";r(e);var t=31536e6;document.cookie="disableGCFCheck=1;path=/;max-age="+t,s=!0},a=function(e,n){var r=t(n.node);e.id=n.id||(r?r.id||getUid(r):"");var i=n.cssText||"";e.style.cssText=" "+i;var s=n.className||"";e.className=s;var o=n.src||"about:blank";e.src=o,r&&r.parentNode.replaceChild(e,r)},f=function(e){var t=document.createElement("iframe");return t.setAttribute("frameborder","0"),t.setAttribute("border","0"),a(t,e),t},l=function(e){e.className="chromeFrameInstallDefaultStyle "+(e.className||"");var t=f(e);if(!t.parentNode){var n=document.body.firstChild;document.body.insertBefore(t,n)}},c=function(e){if(t("chromeFrameOverlayContent"))return;var n=document.createElement("span");n.innerHTML='<div class="chromeFrameOverlayUnderlay"></div><table class="chromeFrameOverlayContent"id="chromeFrameOverlayContent"cellpadding="0" cellspacing="0"><tr class="chromeFrameOverlayCloseBar"><td><button id="chromeFrameCloseButton">close</button></td></tr><tr><td id="chromeFrameIframeHolder"></td></tr></table>';var r=document.body;while(n.firstChild)r.insertBefore(n.lastChild,r.firstChild);var i=f(e);t("chromeFrameIframeHolder").appendChild(i),t("chromeFrameCloseButton").onclick=u},h={};h.check=function(e){e=e||{};var t=navigator.userAgent,r=/MSIE (\S+); Windows NT/,i=!1;r.test(t)?parseFloat(r.exec(t)[1])<6&&t.indexOf("SV1")<0&&(i=!0):i=!0;if(i)return;o(),document.cookie.indexOf("disableGCFCheck=1")>=0&&u();var s=document.location.protocol,a=s=="https:"?"https:":"http:",f=a+"//www.google.com/chromeframe";if(!n()){e.onmissing&&e.onmissing(),e.src=e.url||f;var h=e.mode||"inline",p=e.preventPrompt||!1;p||(h=="inline"?l(e):h=="overlay"?c(e):window.open(e.src));if(e.preventInstallDetection)return;var d=setInterval(function(){n()&&(e.oninstall&&e.oninstall(),clearInterval(d),window.location=e.destination||window.location)},2e3)}},h._force=!1,h._forceValue=!1,h.isAvailable=n,e.CFInstall=h})(this.ChromeFrameInstallScope||this);